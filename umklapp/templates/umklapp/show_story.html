{% extends "umklapp/base.html" %}
{% load bootstrap %}
{% block title %}Story anschauen{% endblock %}

{% block content %}
<div class="container">
<h2>
  {{ story.title }}
</h2>
{% if story.rules %}
<p>(Zusätzliche Regeln: {{ story.rules }})</p>
{% endif %}

<div>
  &mdash; von {{ story.started_by }} und {{ story.numberOfContributors|add:-1 }} weiteren Erzählern.
  {% if has_upvoted %}
    <form style="display:inline" method="post" action="{% url 'downvote_story' story_id=story.id %}">
     {% csrf_token %}
     <button title="Downvote / UnLike" class="no-expand btn btn-default btn-xs btn-success">
      {{ upvote_count }}&nbsp;<span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
     </button>
     </form>
  {% else %}
    <form style="display:inline" method="post" action="{% url 'upvote_story' story_id=story.id %}">
     {% csrf_token %}
     <button title="Upvote / Like" class="no-expand btn btn-default btn-xs">
      {{ upvote_count }}&nbsp;<span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
     </button>
     </form>
  {% endif %}
</div>

{% for p in story.parts %}
  <p class="sentence" >
  {{ p.content }}
{% if not anonymized %}<small class="text-muted">– {{p.teller.user}}</small>{% endif %}
  </p>
{% endfor %}

<div class="actions">
  {% if story.is_finished %}
  {% endif %}

  {% if story.started_by == user %}
    {% if not story.is_public %}
     <form style="display:inline" method="post" action="{% url 'publish_story' story_id=story.id %}">
      {% csrf_token %}
      <button title="Erlaube allen die Geschichte zu sehen" class="btn btn-default btn-sm">Geschichte öffentlich sichtbar machen</button>
     </form>
    {% else %}
     <form style="display:inline" method="post" action="{% url 'unpublish_story' story_id=story.id %}">
      {% csrf_token %}
      <button title="Erlaube doch NICHT allen die Geschichte zu sehen" class="btn btn-default btn-sm">Geschichte nur den Erzählern sichtbar machen</button>
     </form>
    {% endif %}
  {% endif %}


</div>

</div>
{% endblock %}
